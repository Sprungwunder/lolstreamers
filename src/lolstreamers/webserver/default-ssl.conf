<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName searchtherift.com
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html


    # Add host filtering
    RewriteEngine On
    RewriteCond %{HTTP_HOST} !^(searchtherift\.com|www\.searchtherift\.com|195\.90\.208\.42)$ [NC]
    RewriteRule ^ - [F,L]

    # SSL Configuration
    SSLEngine on
    # Replace these paths with your actual certificate file paths
    SSLCertificateFile      /etc/ssl/certs/searchtherift.crt
    SSLCertificateKeyFile   /etc/ssl/private/searchtherift.key
    # If you have a certificate chain file
    SSLCertificateChainFile /etc/ssl/certs/searchtherift-chain.crt

    # Your existing proxy configurations
    <Location /kibana>
        ProxyPass         http://localhost:5601 retry=0
        ProxyPassReverse  http://localhost:5601
    </Location>

    ProxyPreserveHost On
    ProxyPass / http://localhost:8081/
    ProxyPassReverse / http://localhost:8081/

    <Location /api>
        ProxyPass http://localhost:8000
        ProxyPassReverse http://localhost:8000
    </Location>

    ProxyPass /admin/ http://localhost:8000/admin/
    ProxyPassReverse /admin/ http://localhost:8000/admin/

    ProxyPass /static/ http://localhost:8000/static/
    ProxyPassReverse /static/ http://localhost:8000/static/

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName www.searchtherift.com
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    # SSL (certificate must include SAN for www)
    SSLEngine on
    SSLCertificateFile      /etc/ssl/certs/searchtherift.crt
    SSLCertificateKeyFile   /etc/ssl/private/searchtherift.key
    SSLCertificateChainFile /etc/ssl/certs/searchtherift-chain.crt

    # Dedicated logs for the www alias
    ErrorLog ${APACHE_LOG_DIR}/error-searchtherift.log
    CustomLog ${APACHE_LOG_DIR}/access-searchtherift.log combined

    # Canonicalize to apex over HTTPS
    Redirect permanent / https://searchtherift.com/
</VirtualHost>
</IfModule>
